# Контроллер LCD-дисплея HD44780

Контроллер **HD44780**, используемый в LCD-дисплеях (например, 1602), управляет экраном и поддерживает взаимодействие с внешним микроконтроллером. Основные компоненты его схемы управления включают:

## 1. Дисплей (LCD)
- Это физический экран, отображающий символы, состоящий из 1 или 2 строк по 16 символов (например, дисплей 1602).
- Каждый символ формируется в матрице 5x8 точек.

## 2. Контроллер HD44780
- Контроллер управляет отображением символов и взаимодействием с внешними устройствами, такими как микроконтроллеры.
- Содержит регистры для управления курсором, отправки команд и записи данных в дисплей.

## 3. Основные пины и их назначение

| Пин  | Название                  | Описание                                                                |
|------|---------------------------|-------------------------------------------------------------------------|
| 1    | **VSS**                   | Питание "земля".                                                        |
| 2    | **VDD**                   | Положительное питание. Обычно +5 В.                                     |
| 3    | **V0**                    | Контроль контрастности дисплея. Подключается к потенциометру.           |
| 4    | **RS (Register Select)**  | Определяет, идет ли запись в регистр команд (0) или данных (1).         |
| 5    | **RW (Read/Write)**       | Определяет операцию: 0 — запись, 1 — чтение.                            |
| 6    | **E (Enable)**            | Строб для записи команды или данных.                                    |
| 7-14 | **D0-D7**                 | Двухсторонняя 8-битная шина данных (используются D4-D7 в 4-битном режиме). |
| 15   | **A (Anode)**             | Положительный полюс подсветки дисплея.                                  |
| 16   | **K (Cathode)**           | Отрицательный полюс подсветки дисплея.                                  |

## 4. Внутренние регистры
- **IR (Instruction Register)** — регистр команд. Команды, отправляемые через пин RS=0, записываются в этот регистр.
- **DR (Data Register)** — регистр данных. Сюда записываются символы, которые будут отображены на дисплее.

## 5. Память дисплея
- **DDRAM (Display Data RAM)** — память для отображаемых символов (по умолчанию 80 байт). Каждая позиция дисплея связана с определенным адресом в DDRAM.
- **CGRAM (Character Generator RAM)** — область памяти для хранения пользовательских символов (до 8 символов).

## 6. Основные режимы работы
- **8-битный режим** — используются все 8 линий данных D0-D7 для передачи команд и данных.
- **4-битный режим** — используется только половина шины данных (D4-D7), данные передаются в два такта.

## 7. Упрощенная схема подключения LCD с контроллером HD44780

```lua
       +-------------------------------------------+
       |      LCD 1602                             |
       +-------------------------------------------+
      1| VSS  --- GND                              |
      2| VDD  --- +5V                              |
      3| V0   --- Контрастность (потенциометр)     |
      4| RS   --- RS (регистры данных/команд)      |
      5| RW   --- RW (чтение/запись)               |
      6| E    --- Enable (строб)                   |
   7-14| D0-D7 --- Линии данных (в зависимости от режима) |
     15| A   --- Подсветка (+)                     |
     16| K   --- Подсветка (-)                     |
       +-------------------------------------------+
```

## 8. Пример подключения
- Пин **RS** подключается к микроконтроллеру для переключения между командами и данными.
- Пин **RW** может быть подключен к земле (для записи данных).
- Пин **E** используется для стробирования данных.
- **D0-D7** или **D4-D7** используются для передачи команд и данных в зависимости от выбранного режима работы дисплея (8-битный или 4-битный).

Контроллер **HD44780** управляет LCD-дисплеем через последовательность команд, каждая из которых должна быть подтверждена стробом на пине **Enable** для завершения записи команды или данных.



# Команды для LCD 1602 (HD44780)

Команды для управления LCD-дисплеем 1602 (HD44780) делятся на несколько категорий: инициализация, настройка режима работы, управление курсором, очистка дисплея и работа с символами. Каждая команда состоит из 8-битного значения, где определенные биты отвечают за различные функции.

## Основные команды LCD 1602:

### 1. **Function Set (0x38, 0x28)**

Команда для установки режима работы дисплея (разрядность данных, количество строк и размер символов).

- **0x38** — 8-битный режим, 2 строки, 5x8 символов:
  - `0 0 1 DL N F * *`
  - **DL (Data Length)**: 1 — 8-битный режим, 0 — 4-битный.
  - **N (Number of Lines)**: 1 — 2 строки, 0 — 1 строка.
  - **F (Font Size)**: 1 — символы 5x10 точек, 0 — 5x8 точек.
  
  Пример: `0011 1000` → 8-битный режим, 2 строки, 5x8 символов.

- **0x28** — 4-битный режим, 2 строки, 5x8 символов:
  - `0010 1000` → 4-битный режим, 2 строки, 5x8 символов.

### 2. **Display ON/OFF Control (0x0C)**

Управление включением/выключением дисплея, курсора и миганием курсора.

- **0x0C** — Включить дисплей, курсор отключен, мигание отключено:
  - `0 0 0 0 1 D C B`
  - **D (Display)**: 1 — Включить дисплей, 0 — Выключить.
  - **C (Cursor)**: 1 — Включить курсор, 0 — Отключить.
  - **B (Blink)**: 1 — Включить мигание курсора, 0 — Отключить.

  Пример: `0000 1100` → Включить дисплей, отключить курсор и мигание.

### 3. **Clear Display (0x01)**

Очистка дисплея и установка курсора в начальное положение.

- **0x01** — Очистить экран:
  - `0000 0001`

### 4. **Entry Mode Set (0x06)**

Установка режима ввода данных (направление перемещения курсора после ввода символа).

- **0x06** — Автоматический переход курсора вправо, без сдвига экрана:
  - `0 0 0 0 0 1 I/D S`
  - **I/D (Increment/Decrement)**: 1 — перемещение вправо, 0 — влево.
  - **S (Shift)**: 1 — сдвиг экрана, 0 — без сдвига.

  Пример: `0000 0110` → Курсор перемещается вправо, без сдвига экрана.

### 5. **Return Home (0x02)**

Перемещение курсора в начальное положение (адрес 0x00) без очистки дисплея.

- **0x02** — Возврат курсора в начало:
  - `0000 0010`

### 6. **Cursor or Display Shift (0x18, 0x1C)**

Сдвиг курсора или всего экрана влево или вправо.

- **0x18** — Сдвиг дисплея влево:
  - `0 0 0 1 S/C R/L * *`
  - **S/C (Shift/Cursor)**: 1 — сдвиг дисплея, 0 — сдвиг курсора.
  - **R/L (Right/Left)**: 1 — сдвиг вправо, 0 — влево.

  Пример: `0001 1000` → Сдвиг дисплея влево.

- **0x1C** — Сдвиг дисплея вправо:
  - `0001 1100` → Сдвиг дисплея вправо.

### 7. **Set DDRAM Address (0x80 + адрес)**

Установка адреса в памяти для размещения символов (DDRAM).

- **0x80 + адрес** — Установить адрес памяти:
  - `1 адрес`
  
  Пример: `1000 0000` → Установить адрес курсора на первую строку, позиция 0.

### 8. **Set CGRAM Address (0x40 + адрес)**

Установка адреса в памяти для создания пользовательских символов (CGRAM).

- **0x40 + адрес** — Установить адрес памяти CGRAM:
  - `01 адрес`

  Пример: `0100 0000` → Установить адрес для записи в CGRAM.

## Пример последовательности инициализации в 8-битном режиме:

1. **0x38** — Установить 8-битный режим, 2 строки, 5x8 точек.
2. **0x0C** — Включить дисплей, курсор и мигание отключены.
3. **0x01** — Очистить дисплей.
4. **0x06** — Установить режим ввода: курсор перемещается вправо, экран не сдвигается.

## Таблица команд с их побитовой структурой:

| Команда                    | Битовая структура         | Описание                                                |
|----------------------------|---------------------------|---------------------------------------------------------|
| **0x38** (Function Set)     | `0011 1000`               | 8-битный режим, 2 строки, символы 5x8                    |
| **0x28** (Function Set)     | `0010 1000`               | 4-битный режим, 2 строки, символы 5x8                    |
| **0x0C** (Display ON/OFF)   | `0000 1100`               | Включить дисплей, курсор и мигание отключены             |
| **0x01** (Clear Display)    | `0000 0001`               | Очистить дисплей                                         |
| **0x06** (Entry Mode Set)   | `0000 0110`               | Ввод с курсором вправо, без сдвига экрана                |
| **0x02** (Return Home)      | `0000 0010`               | Вернуться в начало (адрес 0x00)                          |
| **0x18** (Shift Display)    | `0001 1000`               | Сдвиг дисплея влево                                      |
| **0x1C** (Shift Display)    | `0001 1100`               | Сдвиг дисплея вправо                                     |
| **0x80** (Set DDRAM Addr)   | `1000 0000` + адрес       | Установить адрес памяти DDRAM                            |
| **0x40** (Set CGRAM Addr)   | `0100 0000` + адрес       | Установить адрес памяти CGRAM для пользовательских символов |

## Стробирование данных

После каждой команды обычно требуется стробировать (отправлять) сигнал для записи в дисплей, что подтверждает передачу данных в LCD.
